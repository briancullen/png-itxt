<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw==" crossorigin="anonymous">
    <script src="pngitxt-browser.js"></script>
  </head>
  <body>
    <div class="page-header">
      <h1>png-itxt Browser Example</h1>
        <p>This page demonstrates the use of the png-itxt library on a webpage.
            To try it out for yourself by dragging an image onto one of the boxes below.
            Remember you will have to save the editing image to see the new field.
        </p>
    </div>
    <div class="row fluid-container">
      <div class="col-sm-6 col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Drop an image to inspect here</h3>
          </div>
          <div id="getZone" class="panel-body" style="height: 150px;">
          </div>
          <table id='getresult' class='table'>
            <thead>
              <tr>
                <th>Type</th>
                <th>Keyword</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody id='getResults'>
              
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm-6 col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Drop an image to here to add a test iTXt chunk</h3>
          </div>
          <div id="setZone" class="panel-body" style="height: 300px;">
            
          </div>
        </div>
      </div>
    </div>

<script>
    function copyEffect (e) {
        e.stopPropagation();
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';      
    }
    var setZone = document.getElementById('setZone');
    var getZone = document.getElementById('getZone');
    getZone.addEventListener('dragover', copyEffect);
    setZone.addEventListener('dragover', copyEffect);

    getZone.addEventListener('drop', function(e) {
      e.stopPropagation();
      e.preventDefault();
      
      var getResults = document.getElementById('getResults')
      getResults.innerHTML = ""
      var files = e.dataTransfer.files;
      for (var i=0, file; file=files[i]; i++) {
        if (file.type.match(/image.png/)) {
          var reader = new FileReader();
          reader.onload = function(e2) { // finished reading file data.
            pngitxt.get(e2.target.result, function (err, data) {
              if (!err && data)
                var row = document.createElement('tr')
                row.innerHTML = "<td>" + data.type + "</td>"
                    + "<td>" + data.keyword + "</td>"
                    + "<td>" + data.value + '</td>'
                getResults.appendChild(row)
            })
          }
          reader.readAsBinaryString(file); // start reading the file data.    
        }
      }
    });

    setZone.addEventListener('drop', function(e) {
      e.stopPropagation();
      e.preventDefault();
      var files = e.dataTransfer.files; // Array of all files
      for (var i=0, file; file=files[i]; i++) {
        if (file.type.match(/image.png/)) {
          var reader = new FileReader();
          reader.onloadend = function(e2) { // finished reading file data.
            pngitxt.set(e2.target.result, { keyword: "test", value: "value"},
                       function (result) {
              var img = document.createElement('img');
              img.src = "data:image/png;base64," + result;
              
              setZone.innerHTML = ""
              setZone.appendChild(img);
            })
          }
          reader.readAsBinaryString(file); // start reading the file data.    
        }
      }
    });
</script>
  </body>
</html>